
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ceylon Electricity Board - Invoice Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.3/cdn.min.js" defer></script>
    <style>
        @media print {
            @page {
                size: A4;
                margin: 15mm;
            }
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .no-print {
                display: none !important;
            }
            .form-section {
                display: none !important;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            font-size: 10px;
            line-height: 1.2;
            color: #000;
            background: #f5f5f5;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .form-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .form-section h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #007acc;
            padding-bottom: 5px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 12px;
        }

        .form-group input, .form-group select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }

        .autocomplete-container {
            position: relative;
        }

        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 4px 4px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .autocomplete-suggestions.show {
            display: block;
        }

        .autocomplete-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            font-size: 12px;
        }

        .autocomplete-item:hover {
            background: #f0f8ff;
        }

        .line-items-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .line-item-form {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 10px;
            align-items: end;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }

        .btn-primary {
            background: #007acc;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .line-items-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 11px;
        }

        .line-items-table th,
        .line-items-table td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .line-items-table th {
            background: #f8f9fa;
            font-weight: bold;
        }

        .line-items-table .text-right {
            text-align: right;
        }

        .grand-total {
            font-size: 14px;
            font-weight: bold;
            background: #e9ecef;
        }

        .container {
            max-width: 210mm;
            margin: 20px auto;
            padding: 10px;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .header {
            display: flex;
            align-items: center;
            border: 2px solid #000;
            margin-bottom: 2px;
        }

        .logo-section {
            width: 60px;
            border-right: 2px solid #000;
            padding: 5px;
            text-align: center;
        }

        .logo {
            width: 40px;
            height: 40px;
            border: 1px solid #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            font-size: 8px;
            background: #f0f0f0;
        }

        .title-section {
            flex: 1;
            padding: 10px;
            text-align: center;
        }

        .main-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .subtitle {
            font-size: 10px;
        }

        .office-info {
            width: 150px;
            border-left: 2px solid #000;
            padding: 10px;
            text-align: center;
        }

        .office-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .info-section {
            display: flex;
            border: 2px solid #000;
            border-top: none;
            margin-bottom: 2px;
        }

        .info-left {
            flex: 1;
            border-right: 1px solid #000;
        }

        .info-right {
            width: 150px;
        }

        .info-row {
            display: flex;
            border-bottom: 1px solid #000;
            min-height: 25px;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            width: 120px;
            padding: 5px 8px;
            border-right: 1px solid #000;
            background: #f8f8f8;
        }

        .info-value {
            flex: 1;
            padding: 5px 8px;
        }

        .table-container {
            border: 2px solid #000;
            margin-bottom: 2px;
        }

        .table-header {
            display: flex;
            background: #f0f0f0;
            border-bottom: 2px solid #000;
            font-weight: bold;
            text-align: center;
        }

        .col-sn { width: 30px; }
        .col-description { flex: 1; }
        .col-unit { width: 40px; }
        .col-rate { width: 60px; }
        .col-qty { width: 50px; }
        .col-amount { width: 70px; }
        .col-cert-qty { width: 50px; }
        .col-cert-amount { width: 80px; }

        .table-header > div {
            padding: 8px 4px;
            border-right: 1px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .table-header > div:last-child {
            border-right: none;
        }

        .table-row {
            display: flex;
            border-bottom: 1px solid #000;
            min-height: 20px;
        }

        .table-row:last-child {
            border-bottom: none;
        }

        .table-row > div {
            padding: 3px 4px;
            border-right: 1px solid #000;
            font-size: 9px;
        }

        .table-row > div:last-child {
            border-right: none;
        }

        .summary-section {
            border: 2px solid #000;
            border-top: none;
            min-height: 80px;
        }

        .summary-text {
            padding: 10px;
            text-align: center;
            font-size: 9px;
            line-height: 1.4;
        }

        .signature-section {
            display: flex;
            border: 2px solid #000;
            border-top: none;
            margin-bottom: 2px;
        }

        .signature-left {
            flex: 1;
            border-right: 1px solid #000;
            padding: 10px;
        }

        .signature-right {
            width: 200px;
            padding: 10px;
        }

        .signature-row {
            margin-bottom: 15px;
        }

        .signature-label {
            font-size: 9px;
            margin-bottom: 20px;
        }

        .signature-line {
            border-bottom: 1px solid #000;
            height: 1px;
            margin-bottom: 5px;
        }

        .footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 8px;
            margin-top: 10px;
        }

        .controls {
            text-align: center;
            margin: 20px 0;
        }

        @media screen and (max-width: 800px) {
            .line-item-form {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container" x-data="invoiceApp()">
        <!-- Form Section -->
        <div class="form-section no-print">
            <h2>Invoice Information</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>Contractor Name</label>
                    <input type="text" x-model="invoiceData.contractorName" placeholder="Enter contractor name">
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <input type="text" x-model="invoiceData.location" placeholder="Enter location">
                </div>
                <div class="form-group">
                    <label>Service Number</label>
                    <input type="text" x-model="invoiceData.serviceNumber" placeholder="Enter service number">
                </div>
                <div class="form-group">
                    <label>Report Date</label>
                    <input type="date" x-model="invoiceData.reportDate">
                </div>
            </div>
        </div>

        <!-- Line Items Section -->
        <div class="line-items-section no-print">
            <h2>Line Items</h2>
            
            <!-- Add Line Item Form -->
            <div class="line-item-form">
                <div class="form-group">
                    <label>Description</label>
                    <div class="autocomplete-container">
                        <input 
                            type="text" 
                            x-model="currentItem.description"
                            @input="showSuggestions = true"
                            @blur="setTimeout(() => showSuggestions = false, 200)"
                            placeholder="Start typing description...">
                        <div class="autocomplete-suggestions" :class="{ 'show': showSuggestions && filteredSuggestions.length > 0 }">
                            <template x-for="suggestion in filteredSuggestions" :key="suggestion.description">
                                <div class="autocomplete-item" @click="selectSuggestion(suggestion)">
                                    <div x-text="suggestion.description"></div>
                                    <small style="color: #666;">Rs. <span x-text="suggestion.rate"></span> per <span x-text="suggestion.unit"></span></small>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Rate (Rs.)</label>
                    <input 
                        type="number" 
                        x-model.number="currentItem.rate" 
                        @input="calculateAmount()"
                        step="0.01"
                        placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Quantity</label>
                    <input 
                        type="number" 
                        x-model.number="currentItem.quantity" 
                        @input="calculateAmount()"
                        step="0.01"
                        placeholder="0">
                </div>
                <div class="form-group">
                    <label>Amount (Rs.)</label>
                    <input 
                        type="number" 
                        x-model.number="currentItem.amount" 
                        readonly
                        style="background: #f8f9fa;">
                </div>
                <div class="form-group">
                    <button type="button" class="btn btn-primary" @click="addLineItem()" :disabled="!canAddItem()">
                        Add Item
                    </button>
                </div>
            </div>

            <!-- Line Items Table -->
            <table class="line-items-table" x-show="lineItems.length > 0">
                <thead>
                    <tr>
                        <th style="width: 30px;">S/N</th>
                        <th>Description</th>
                        <th style="width: 60px;">Unit</th>
                        <th style="width: 80px;">Rate (Rs.)</th>
                        <th style="width: 80px;">Qty.</th>
                        <th style="width: 100px;">Amount (Rs.)</th>
                        <th style="width: 80px;" class="no-print">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="(item, index) in lineItems" :key="index">
                        <tr>
                            <td x-text="index + 1"></td>
                            <td x-text="item.description"></td>
                            <td x-text="item.unit"></td>
                            <td class="text-right" x-text="parseFloat(item.rate).toFixed(2)"></td>
                            <td class="text-right" x-text="parseFloat(item.quantity).toFixed(2)"></td>
                            <td class="text-right" x-text="parseFloat(item.amount).toFixed(2)"></td>
                            <td class="no-print">
                                <button type="button" class="btn btn-danger" @click="removeLineItem(index)">
                                    Remove
                                </button>
                            </td>
                        </tr>
                    </template>
                    <tr class="grand-total">
                        <td colspan="5" style="text-align: right; font-weight: bold;">Grand Total:</td>
                        <td class="text-right" style="font-weight: bold;" x-text="'Rs. ' + grandTotal.toFixed(2)"></td>
                        <td class="no-print"></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Print Controls -->
        <div class="controls no-print">
            <button type="button" class="btn btn-success" @click="printInvoice()" :disabled="lineItems.length === 0">
                Print Invoice
            </button>
        </div>

        <!-- Invoice Template -->
        <div class="container">
            <!-- Header Section -->
            <div class="header">
                <div class="logo-section">
                    <div class="logo">CEB</div>
                </div>
                <div class="title-section">
                    <div class="main-title">Ceylon Electricity Board</div>
                    <div class="subtitle">සිංහල විදුලි ශක්ති මණ්ඩලය</div>
                </div>
                <div class="office-info">
                    <div class="office-title">Ceylon Electricity Board</div>
                    <div>Area Office - Matara</div>
                </div>
            </div>

            <!-- Information Section -->
            <div class="info-section">
                <div class="info-left">
                    <div class="info-row">
                        <div class="info-label">සන්ත්‍රාගතකරුගේ නම :</div>
                        <div class="info-value" x-text="invoiceData.contractorName"></div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">ස්ථානය :</div>
                        <div class="info-value" x-text="invoiceData.location"></div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">සේවයේ අංකය :</div>
                        <div class="info-value" x-text="invoiceData.serviceNumber"></div>
                    </div>
                </div>
                <div class="info-right">
                    <div class="info-row">
                        <div class="info-value" style="text-align: center; font-weight: bold;">ඉදිරිපත් කරන්නේ</div>
                    </div>
                    <div class="info-row">
                        <div class="info-value"></div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">වාර්තාව දිනය :</div>
                        <div class="info-value" x-text="formatDate(invoiceData.reportDate)"></div>
                    </div>
                </div>
            </div>

            <!-- Table Section -->
            <div class="table-container">
                <div class="table-header">
                    <div class="col-sn">S/N</div>
                    <div class="col-description">Description</div>
                    <div class="col-unit">Unit</div>
                    <div class="col-rate">Rate<br>(Rs.)</div>
                    <div class="col-qty">Qty.</div>
                    <div class="col-amount">Amount<br>(Rs.)</div>
                    <div class="col-cert-qty">Certified<br>Qty.</div>
                    <div class="col-cert-amount">Amount (Rs.)</div>
                </div>

                <!-- Dynamic Table Rows -->
                <template x-for="(item, index) in printableRows" :key="index">
                    <div class="table-row">
                        <div class="col-sn" x-text="item.sn"></div>
                        <div class="col-description" x-text="item.description"></div>
                        <div class="col-unit" x-text="item.unit"></div>
                        <div class="col-rate" x-text="item.rate"></div>
                        <div class="col-qty" x-text="item.quantity"></div>
                        <div class="col-amount" x-text="item.amount"></div>
                        <div class="col-cert-qty" x-text="item.certifiedQty"></div>
                        <div class="col-cert-amount" x-text="item.certifiedAmount"></div>
                    </div>
                </template>
            </div>

            <!-- Summary Section -->
            <div class="summary-section">
                <div class="summary-text">
                    රුපියල් : <span x-text="grandTotal.toFixed(2)"></span><br><br>
                    ගම නියස මන්ත්‍රී ල.ම. ප්‍රමතිගලේ අනුකූල නුති සහ ඇ.ද. අනුකූල පරුක්‍ෂව හෝ පන්න ලබන පනත් පලම් පරිවර්තන.
                </div>
            </div>

            <!-- Signature Section -->
            <div class="signature-section">
                <div class="signature-left">
                    <div class="signature-row">
                        <div class="signature-label">කෝන්ත්‍රාත්කරුගේ අත්සන</div>
                        <div class="signature-line"></div>
                    </div>
                    <div class="signature-row">
                        <div class="signature-label">නම.ප.නම. අත්සන</div>
                        <div class="signature-line"></div>
                    </div>
                    <div class="signature-row">
                        <div class="signature-label">දි.ය. (ප.වේ.ම. /ප.නම.ය.)</div>
                        <div class="signature-line"></div>
                    </div>
                </div>
                <div class="signature-right">
                    <div class="signature-row">
                        <div class="signature-label">වේ.ඉ.නියමුත්කරුගේ සහතික</div>
                        <div class="signature-line"></div>
                    </div>
                    <div class="signature-row">
                        <div class="signature-label">වේ.ප.(ම.වි./ප.ප්‍රමුක්‍ෂ.</div>
                        <div class="signature-line"></div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="footer">
                <span>Document No. : CE/MT/MHT/0/02</span>
                <span>Date of Issue: 30.11.2017</span>
                <span>Revised By: SEM</span>
                <span>Approved :</span>
            </div>
        </div>
    </div>

<script>
function invoiceApp(){return{invoiceData:{contractorName:"",location:"",serviceNumber:"",reportDate:(new Date).toISOString().split("T")[0]},currentItem:{description:"",unit:"Nos",rate:0,quantity:0,amount:0},lineItems:[],showSuggestions:!1,serviceDescriptions:[{description:"Pole transport (...........) Km",rate:1500,unit:"Nos"},{description:"Excavation of pole pits 6m/6.7m 15\" 30/33KV",rate:2500,unit:"Nos"},{description:"Excavation of pole pits 10-8.3m/100-11.5m (Existing...)",rate:3e3,unit:"Nos"},{description:"Excavation of pole pits 590/250Kg",rate:2200,unit:"Nos"},{description:"Excavation of stay pit - LT",rate:800,unit:"Nos"},{description:"Erection of Pole/- 6m/8.5m W/R/Cpoles",rate:4500,unit:"Nos"},{description:"Erection of Pole - 9m/8.5m W/R/C poles",rate:5e3,unit:"Nos"},{description:"Erection of Pole - 9m/250/300m RC poles",rate:5500,unit:"Nos"},{description:"Erection of feaut - LT W/RC",rate:1200,unit:"Nos"},{description:"Erection of stay LT - Normal",rate:1800,unit:"Nos"},{description:"Concreting of pole pits 9/250Kg and 9/500",rate:3500,unit:"Nos"},{description:"Removal of stay completely",rate:800,unit:"Nos"},{description:"Removal of Hardware from Existing LV Poles 1ph/3ph",rate:600,unit:"Nos"},{description:"Stringing of AAC/ABC Conductors 1ph/3ph",rate:8500,unit:"Km"},{description:"Removal of AAC/ABC Conductors 1ph/3ph",rate:2500,unit:"Km"},{description:"Re-Tensioning of AAC (Fly) Conductors",rate:1500,unit:"Km"},{description:"Re-Tensioning of ABC - 1ph/3ph",rate:1800,unit:"Km"},{description:"Removal of Pole/Struct - 8.3/9m - Wooden Re-usable",rate:1200,unit:"Nos"},{description:"Removal of Pole/Struct - 8.3/9m - RC Re-usable",rate:1500,unit:"Nos"},{description:"Removal of Pole/Struct - 6m/8.5m/9m - W/RC Un-usable",rate:800,unit:"Nos"},{description:"Removal and reconnection of service wire 1ph/3ph",rate:450,unit:"Nos"},{description:"Changing of service Wire with New wire (Length of service below 30m/Length of service above 30m)",rate:650,unit:"Nos"},{description:"Rehabilitation of existing services (Length of service below 30m/Length of service above 30m)",rate:750,unit:"Nos"}],get filteredSuggestions(){return this.currentItem.description?this.serviceDescriptions.filter(item=>item.description.toLowerCase().includes(this.currentItem.description.toLowerCase())):[]},get grandTotal(){return this.lineItems.reduce((total,item)=>total+parseFloat(item.amount||0),0)},get printableRows(){const t=[],e=25;return this.lineItems.forEach((n,o)=>{t.push({sn:o+1,description:n.description,unit:n.unit,rate:parseFloat(n.rate).toFixed(2),quantity:parseFloat(n.quantity).toFixed(2),amount:parseFloat(n.amount).toFixed(2),certifiedQty:parseFloat(n.quantity).toFixed(2),certifiedAmount:parseFloat(n.amount).toFixed(2)})}),this.lineItems.length<e&&function(t,e){for(let n=t.length;n<e;n++)t.push({sn:n+1,description:"",unit:"",rate:"",quantity:"",amount:"",certifiedQty:"",certifiedAmount:""})}(t,e),t},selectSuggestion(t){this.currentItem.description=t.description,this.currentItem.rate=t.rate,this.currentItem.unit=t.unit,this.showSuggestions=!1,this.calculateAmount()},calculateAmount(){this.currentItem.amount=(this.currentItem.rate||0)*(this.currentItem.quantity||0)},canAddItem(){return this.currentItem.description&&this.currentItem.rate>0&&this.currentItem.quantity>0},addLineItem(){if(this.canAddItem()){this.lineItems.push({description:this.currentItem.description,unit:this.currentItem.unit,rate:this.currentItem.rate,quantity:this.currentItem.quantity,amount:this.currentItem.amount}),this.currentItem={description:"",unit:"Nos",rate:0,quantity:0,amount:0}}},removeLineItem(t){confirm("Are you sure you want to delete this?")?this.lineItems.splice(t,1):console.log("Cancelled")},formatDate(t){if(!t)return"";const e=new Date(t);return e.toLocaleDateString("en-GB")},printInvoice(){window.print()}}}
</script>

</body>
</html>